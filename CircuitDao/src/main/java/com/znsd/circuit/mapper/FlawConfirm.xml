<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.znsd.circuit.dao.FlawConfirmDao">
	<select id="getFlawConfirmCount" resultType="int" parameterType="Map">
		SELECT count(1)
		FROM t_flawconfirm c
		INNER JOIN t_task t ON c.taskId=t.id
		INNER JOIN t_thread h ON c.threadId=h.id
		INNER JOIN t_tower o ON c.towerId=o.id
		INNER JOIN t_flaw f ON c.flawId=f.id
		INNER JOIN t_flaw_record r ON c.id=r.flawconfirmId
		WHERE confirmstate=0 AND r.receiptState=1
	</select>
	<select id="getFlawConfirmPager" resultType="FlawCont" parameterType="Map">
		SELECT c.id,t.coding AS taskcoding,h.coding AS threadcoding,o.coding AS towercoding,
		f.`name` AS flawname,c.serviceAbility,c.flawDesc,c.discoverDate,c.userId,c.flawGrade,c.confirmstate
		FROM t_flawconfirm c
		INNER JOIN t_task t ON c.taskId=t.id
		INNER JOIN t_thread h ON c.threadId=h.id
		INNER JOIN t_tower o ON c.towerId=o.id
		INNER JOIN t_flaw f ON c.flawId=f.id
		INNER JOIN t_flaw_record r ON c.id=r.flawconfirmId
		WHERE confirmstate=0 AND r.receiptState=1
		LIMIT #{pageIndex},#{pageSize}
	</select>
</mapper>
